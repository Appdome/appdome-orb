description: >
  Running Appdome iOS auto signing.

parameters:
  appdome-api-token:
      type: env_var_name
      description: "Appdome-provided API token"
      default: ${"APPDOME_API_KEY"}
  appFile:
    type: string
    description: "Absolute path to your app"
  fusion-set-id:
    type: string
    description: "Fusion Set with the features you want to add to your application."
  output:
    type: string
    description: "The name of the output fused app."
  keystore-file:
    type: string
    default: ""
    description: "iOS: A P12 certificate file is a certificate and private key concatenated into a single file, protected by a password.
    Android: This should be the same keystore file used to sign your Android app when distributing it via Google Play."
  keystore-password:
    type: string
    default: ""
    description: "The password used to unlock your P12/Ketstore certificate file."
  provisioning-profiles:
    type: string
    default: ""
    description: "A Provisioning Profile allows you to install apps onto your iOS device and includes the signing certificates,
     a list of supported device identifiers, entitlements, and an App ID."
  entitlements:
    type: string
    default: ""
    description: "A plist file with the entitlements used for the application. Can be obtained from the Derived Data folder in Xcode"
  sign-overrides:
    type: string
    default: ""
    description: "Optional parameter - json file overrides to pass arguments to overrides sign parameters."
steps:
  - run:
      environment:
        APPDOME_API_KEY: <<parameters.appdome-api-token>>
        APPFILE: <<parameters.appFile>>
        FUSIONSET: <<parameters.fusion-set-id>>
        OUTPUT: <<parameters.output>>
        KEYSTORE: <<parameters.keystore-file>>
        KEYSTORE_PASS: <<parameters.keystore-password>>
        PROVISIONING_PROFILES: <<parameters.provisioning-profiles>>
        ENTITLEMENTS: <<parameters.entitlements>>
        SIGNOVERRIDES: <<parameters.sign-overrides>>
        APPDOME_CLIENT_HEADER: CircleCI/1.0
      name: Build Sign Download (iOS - Automatic Signing)
      command: <<include(scripts/appdome_ios_auto_sign.sh)>>
